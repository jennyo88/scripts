#!/usr/bin/env bash

# Define the fixed path to the scripts on GitHub
SCRIPT_URL="https://github.com/jennyo88/scripts/raw/main/books/overdrive"

# Fetch and run the fixed script from GitHub
fetch_and_run_fixed_script() {
    local script_url=$1
    local audiobook_file=$2

    # Fetch the fixed script
    wget -q -O "overdrive" "$script_url"

    # Check if the script was fetched successfully
    if [ $? -eq 0 ]; then
        echo "Running fixed script: overdrive"
        # Run the fetched script with provided audiobook file name
        bash "overdrive" "$audiobook_file"
        # Remove the fetched script
        rm "overdrive"
    else
        echo "Failed to fetch script: $script_url"
    fi
}

# Prompt user to enter the audiobook file name
read -p "Enter name of the audiobook file: " audiobook_file

# Run the fixed script with the provided audiobook file name
fetch_and_run_fixed_script "$SCRIPT_URL" "$audiobook_file"

# List directories in the current directory with numbers
echo "List of directories in the current directory:"
directories=($(find . -maxdepth 1 -type d))
for ((i=0; i<${#directories[@]}; i++)); do
    echo "$i. ${directories[$i]}"
done

# Prompt user to choose the directory number
read -p "Enter the number corresponding to the folder to run pybind: " selected_index

# Validate user input
if [[ $selected_index =~ ^[0-9]+$ && $selected_index -ge 0 && $selected_index -lt ${#directories[@]} ]]; then
    pybind_folder="${directories[$selected_index]}"
    echo "Running pybind with folder: $pybind_folder"
    # Run pybind program with the chosen folder name
    pybind -d "$pybind_folder"
else
    echo "Invalid selection. Exiting..."
fi
