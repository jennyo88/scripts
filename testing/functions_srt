# -------------------------
# extract_srt / convert_srt
# -------------------------

# Function: Extract subtitles from a video file to an SRT file
extract_srt() {
  input=$(whiptail --title "Extract Subtitles" --inputbox "Enter the input video file (e.g., video.mp4):" 8 60 3>&1 1>&2 2>&3)
  if [ -z "$input" ]; then
    whiptail --title "Error" --msgbox "Input file is required. Operation aborted." 8 45
    return 1
  fi
  
  output=$(whiptail --title "Extract Subtitles" --inputbox "Enter the output subtitle file name (e.g., output.srt):" 8 60 3>&1 1>&2 2>&3)
  if [ -z "$output" ]; then
    whiptail --title "Error" --msgbox "Output file name is required. Operation aborted." 8 45
    return 1
  fi
  
  whiptail --title "Processing" --infobox "Extracting subtitles from $input..." 8 60
  # Using ffmpeg to extract the first subtitle stream.
  ffmpeg -y -i "$input" -map 0:s:0 "$output"
  
  if [ $? -eq 0 ]; then
    whiptail --title "Success" --msgbox "Subtitles extracted successfully to $output." 8 60
  else
    whiptail --title "Error" --msgbox "Failed to extract subtitles from $input." 8 60
  fi
}

# Function: Convert subtitle file encoding/format
convert_srt() {
  input=$(whiptail --title "Convert Subtitles" --inputbox "Enter the input subtitle file (e.g., input.srt):" 8 60 3>&1 1>&2 2>&3)
  if [ -z "$input" ]; then
    whiptail --title "Error" --msgbox "Input file is required. Operation aborted." 8 45
    return 1
  fi
  
  output=$(whiptail --title "Convert Subtitles" --inputbox "Enter the output subtitle file name (e.g., output.srt):" 8 60 3>&1 1>&2 2>&3)
  if [ -z "$output" ]; then
    whiptail --title "Error" --msgbox "Output file name is required. Operation aborted." 8 45
    return 1
  fi
  
  charset=$(whiptail --title "Convert Subtitles" --inputbox "Enter the desired character set (e.g., UTF-8):" 8 60 "UTF-8" 3>&1 1>&2 2>&3)
  
  whiptail --title "Processing" --infobox "Converting subtitles encoding..." 8 60
  # Determine the current encoding via file command and convert with iconv.
  current_charset=$(file -bi "$input" | sed -e 's/.*[ ]charset=//')
  iconv -f "$current_charset" -t "$charset" "$input" -o "$output"
  
  if [ $? -eq 0 ]; then
    whiptail --title "Success" --msgbox "Subtitle file converted successfully to $output with encoding $charset." 8 60
  else
    whiptail --title "Error" --msgbox "Failed to convert subtitle file." 8 60
  fi
}

