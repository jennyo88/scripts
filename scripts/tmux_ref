#!/usr/bin/env_bash

# tmux reference interactive script

# ANSI color codes
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
RESET='\033[0m'

# Function to print the header at the top of the menu
print_header() {
    clear
    echo "==================== TMUX REFERENCE SCRIPT ===================="
    echo "Press Ctrl+C to exit at any time."
    echo ""
}

# Function to create a new tmux session
create_session() {
    # Check if already in a session
    if [ -n "$TMUX" ]; then
        echo -e "${RED}Error: You are already in a tmux session. Cannot create a new session.${RESET}"
        return
    fi

    read -p "Enter session name: " session_name

    # Check if the session already exists
    if tmux has-session -t "$session_name" 2>/dev/null; then
        echo -e "${RED}Error: Session '$session_name' already exists. Choose a different name.${RESET}"
    else
        # If the session doesn't exist, create a new one
        tmux new-session -s "$session_name"
    fi
}

# Function to list existing tmux sessions
list_sessions() {
    tmux list-sessions
}

# Function to attach to a specific tmux session
attach_session() {
    read -p "Enter session name to attach: " session_name

    # Check if the session exists before attempting to attach
    if tmux has-session -t "$session_name" 2>/dev/null; then
        tmux attach -t "$session_name"
    else
        echo -e "${RED}Error: Session '$session_name' does not exist.${RESET}"
    fi
}

# Function to detach from the current tmux session
detach_session() {
    tmux detach
}

# Function to split the tmux pane horizontally
split_horizontal() {
    tmux split-window -h
}

# Function to split the tmux pane vertically
split_vertical() {
    tmux split-window -v
}

# Function to navigate between tmux panes
navigate_panes() {
    tmux select-pane -t :.+
}

# Function to close the current tmux pane
close_pane() {
    # Check if there is more than one pane before attempting to close
    if [ "$(tmux list-panes | wc -l)" -gt 1 ]; then
        tmux kill-pane
    else
        echo -e "${RED}Error: Cannot close the last pane in the window.${RESET}"
    fi
}

# Function to rename the current tmux session
rename_session() {
    read -p "Enter new session name: " new_session_name
    tmux rename-session -t "$(tmux display-message -p '#S')" "$new_session_name"
}

# Function to display information about the current tmux session
show_session_info() {
    tmux display-message -p "#{session_name} (#{session_id}): #{session_windows} windows"
}

# Function to kill a tmux session
kill_session() {
    read -p "Enter session name to kill: " session_name

    # Check if the session exists before attempting to kill
    if tmux has-session -t "$session_name" 2>/dev/null; then
        tmux kill-session -t "$session_name"
        echo -e "${GREEN}Session '$session_name' has been killed.${RESET}"
    else
        echo -e "${RED}Error: Session '$session_name' does not exist.${RESET}"
    fi
}

# Function for the main menu loop
main_menu() {
    echo -e "\n"  # Add a space before the menu
    PS3="Choose a tmux command (enter a number): "

    options=(
        "Create a new session"
        "List sessions"
        "Attach to a session"
        "Detach from the current session"
        "Split pane horizontally"
        "Split pane vertically"
        "Navigate between panes"
        "Close current pane"
        "Rename session"
        "Show session information"
        "Kill a session"
        "Exit"
    )

    select opt in "${options[@]}"; do
        case $REPLY in
            1) create_session ;;
            2) list_sessions ;;
            3) attach_session ;;
            4) detach_session ;;
            5) split_horizontal ;;
            6) split_vertical ;;
            7) navigate_panes ;;
            8) close_pane ;;
            9) rename_session ;;
            10) show_session_info ;;
            11) kill_session ;;
            12)
                echo -e "${GREEN}Exiting the tmux reference script. Goodbye!${RESET}"
                exit 0
                ;;
            *)
                echo -e "${RED}Invalid choice. Please enter a valid number.${RESET}"
                ;;
        esac
    done
}

# Main loop to display the header and run the main menu
while true; do
    print_header
    main_menu
done
